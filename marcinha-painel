<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Marcinha Semijoias - Painel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide (SEM React) -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-[#FDFBF7]">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    function Icon({ name, className = '', size = 22 }) {
      return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
    }

    function App() {
      const [view, setView] = useState('catalog');
      const [products, setProducts] = useState([]);
      const [cart, setCart] = useState([]);
      const [orders, setOrders] = useState([]);
      const [lastOrder, setLastOrder] = useState(null);
      const [customer, setCustomer] = useState({ name: '', phone: '+55' });

      const [storeConfig, setStoreConfig] = useState({
        name: 'Marcinha Semijoias',
        whatsapp: '5511999999999',
        pixDiscount: 0.1,
        maxInstallments: 6
      });

      useEffect(() => {
        const savedProducts = JSON.parse(localStorage.getItem('products') || '[]');
        const savedOrders = JSON.parse(localStorage.getItem('orders') || '[]');

        if (savedProducts.length) {
          setProducts(savedProducts);
        } else {
          setProducts([
            { id: 1, name: 'Anel Luxo', price: 199.9, stock: 10 },
            { id: 2, name: 'Colar Elegance', price: 349.9, stock: 5 }
          ]);
        }
        setOrders(savedOrders);
      }, []);

      useEffect(() => {
        setTimeout(() => lucide.createIcons(), 0);
      });

      const formatCurrency = v => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

      const subtotal = useMemo(() => cart.reduce((a, i) => a + i.price * i.qty, 0), [cart]);
      const total = subtotal * (1 - storeConfig.pixDiscount);

      const addToCart = p => {
        setCart(prev => {
          const exists = prev.find(i => i.id === p.id);
          if (exists) return prev.map(i => i.id === p.id ? { ...i, qty: i.qty + 1 } : i);
          return [...prev, { ...p, qty: 1 }];
        });
      };

      return (
        <div className="min-h-screen pb-24">
          <header className="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
            <button onClick={() => setView('admin')} className="text-[#A68966]">
              <Icon name="unlock" />
            </button>
            <h1 className="uppercase tracking-[0.4em] text-sm">{storeConfig.name}</h1>
            <button onClick={() => setView('cart')} className="relative text-[#A68966]">
              <Icon name="shopping-cart" />
              {cart.length > 0 && (
                <span className="absolute -top-1 -right-1 bg-[#A68966] text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center">{cart.length}</span>
              )}
            </button>
          </header>

          <main className="max-w-xl mx-auto p-4">
            {view === 'catalog' && (
              <div className="space-y-8">
                {products.map(p => (
                  <div key={p.id} className="bg-white p-4 border shadow-sm">
                    <h3 className="text-lg">{p.name}</h3>
                    <p className="text-sm text-gray-500">{formatCurrency(p.price)}</p>
                    <button onClick={() => addToCart(p)} className="mt-4 w-full bg-black text-white py-3 uppercase text-xs">Adicionar</button>
                  </div>
                ))}
              </div>
            )}

            {view === 'cart' && (
              <div className="space-y-6">
                <button onClick={() => setView('catalog')} className="text-[#A68966] flex items-center gap-2">
                  <Icon name="chevron-left" /> Voltar
                </button>

                {cart.map(i => (
                  <div key={i.id} className="flex justify-between border-b pb-2">
                    <span>{i.qty}x {i.name}</span>
                    <span>{formatCurrency(i.price * i.qty)}</span>
                  </div>
                ))}

                <div className="text-right font-bold">Total PIX: {formatCurrency(total)}</div>
              </div>
            )}
          </main>

          <footer className="fixed bottom-0 left-0 right-0 bg-white border-t py-3 flex justify-around">
            <button onClick={() => setView('catalog')} className="text-[#A68966] flex flex-col items-center text-xs">
              <Icon name="store" /> Vitrine
            </button>
            <button onClick={() => setView('cart')} className="text-[#A68966] flex flex-col items-center text-xs">
              <Icon name="shopping-cart" /> Sacola
            </button>
            <button onClick={() => setView('admin')} className="text-[#A68966] flex flex-col items-center text-xs">
              <Icon name="package" /> Gest√£o
            </button>
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
