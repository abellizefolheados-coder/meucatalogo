<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Marcinha Semijoias - Painel</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
import React, { useState, useEffect, useMemo } from 'react';
import {
  ShoppingCart, Settings, Plus, Minus, Trash2, Download, MessageCircle, Package, ChevronLeft, CreditCard, Banknote, Store, CheckCircle2, Image as ImageIcon, Upload, Edit3, Tag, Save, Unlock
} from 'lucide-react';

const appId = typeof __app_id !== 'undefined' ? __app_id : 'abella-joias-v5';

export default function App() {
  /* ===================== ESTADOS ===================== */
  const [view, setView] = useState('catalog'); 
  const [products, setProducts] = useState([]);
  const [cart, setCart] = useState([]);
  const [orders, setOrders] = useState([]);
  const [lastOrder, setLastOrder] = useState(null);
  const [customer, setCustomer] = useState({ name: '', phone: '+55' });
  const [paymentMethod, setPaymentMethod] = useState('pix');
  const [installments, setInstallments] = useState(1);
  const [storeConfig, setStoreConfig] = useState({
    name: 'Abella Joias',
    whatsapp: '5511999999999',
    pixDiscount: 0.10,
    maxInstallments: 6
  });
  const [newProduct, setNewProduct] = useState({ sku: '', name: '', price: '', image: '', stock: 0 });

  /* ===================== INICIALIZAÇÃO ===================== */
  useEffect(() => {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
    script.async = true;
    document.body.appendChild(script);

    const savedProducts = JSON.parse(localStorage.getItem('products') || '[]');
    const savedOrders = JSON.parse(localStorage.getItem('orders') || '[]');
    const savedConfig = JSON.parse(localStorage.getItem('storeConfig') || 'null');

    if (savedProducts.length) {
      setProducts(savedProducts);
    } else {
      const initial = [
        { id: 1, sku: 'AJ-001', name: 'Anel Luxo Cravejado', price: 199.9, image: '', stock: 10 },
        { id: 2, sku: 'AJ-002', name: 'Colar Elegance Ouro', price: 350.0, image: '', stock: 5 }
      ];
      setProducts(initial);
    }
    if (savedOrders.length) setOrders(savedOrders);
    if (savedConfig) setStoreConfig(savedConfig);
  }, []);

  /* ===================== LÓGICA DE ACESSO (DESBLOQUEADA) ===================== */
  const goToAdmin = () => {
    setView('admin');
    window.scrollTo(0, 0);
  };

  /* ===================== UTILITÁRIOS ===================== */
  const formatCurrency = v => Number(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
  
  const subtotal = useMemo(() => cart.reduce((a, i) => a + (Number(i.price) * i.qty), 0), [cart]);
  const discount = useMemo(() => paymentMethod === 'pix' ? subtotal * storeConfig.pixDiscount : 0, [paymentMethod, subtotal, storeConfig.pixDiscount]);
  const total = useMemo(() => subtotal - discount, [subtotal, discount]);

  const removeItem = (id) => {
    setCart(prev => prev.filter(item => item.id !== id));
  };

  /* ===================== LÓGICA DE PRODUTOS ===================== */
  const handleImageUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setNewProduct({ ...newProduct, image: reader.result });
      };
      reader.readAsDataURL(file);
    }
  };

  const addProduct = e => {
    e.preventDefault();
    if (!newProduct.name || !newProduct.price) return alert("Preencha nome e preço!");
    const updated = [...products, { ...newProduct, id: Date.now(), price: Number(newProduct.price), stock: Number(newProduct.stock) }];
    setProducts(updated);
    localStorage.setItem('products', JSON.stringify(updated));
    setNewProduct({ sku: '', name: '', price: '', image: '', stock: 0 });
    alert("Produto adicionado com sucesso!");
  };

  const deleteProduct = (id) => {
    if (window.confirm("Deseja realmente excluir este produto?")) {
      const updated = products.filter(p => p.id !== id);
      setProducts(updated);
      localStorage.setItem('products', JSON.stringify(updated));
    }
  };

  /* ===================== LÓGICA DE CONFIGURAÇÃO ===================== */
  const saveConfig = (e) => {
    e.preventDefault();
    localStorage.setItem('storeConfig', JSON.stringify(storeConfig));
    alert("Configurações da loja atualizadas!");
  };

  /* ===================== LÓGICA DE VENDA ===================== */
  const addToCart = product => {
    if (product.stock <= 0) return;
    setCart(prev => {
      const exists = prev.find(p => p.id === product.id);
      if (exists) return prev.map(p => p.id === product.id ? { ...p, qty: p.qty + 1 } : p);
      return [...prev, { ...product, qty: 1 }];
    });
  };

  const finalizeSale = () => {
    if (!customer.name || customer.phone.length < 10) return alert("Por favor, preencha o nome e o telefone do cliente.");
    
    const order = {
      id: Math.floor(1000 + Math.random() * 9000),
      date: new Date().toLocaleString('pt-BR'),
      customer: { ...customer },
      items: cart.map(i => ({ ...i })),
      paymentMethod,
      installments: paymentMethod === 'card' ? installments : 1,
      subtotal, discount, total
    };
    const newOrders = [order, ...orders];
    setOrders(newOrders);
    localStorage.setItem('orders', JSON.stringify(newOrders));
    
    const updatedProducts = products.map(p => {
      const item = cart.find(ci => ci.id === p.id);
      return item ? { ...p, stock: p.stock - item.qty } : p;
    });
    setProducts(updatedProducts);
    localStorage.setItem('products', JSON.stringify(updatedProducts));

    setLastOrder(order);
    setCart([]);
    setCustomer({ name: '', phone: '+55' });
    setView('confirmed');
  };

  const deleteOrder = (id) => {
    if (window.confirm("Eliminar registo de venda?")) {
      const updated = orders.filter(o => o.id !== id);
      setOrders(updated);
      localStorage.setItem('orders', JSON.stringify(updated));
    }
  };

  const generatePdf = (order) => {
    const element = document.getElementById(`print-receipt-${order.id}`);
    const opt = {
      margin: 0,
      filename: `Recibo_${order.id}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    window.html2pdf().from(element).set(opt).save();
  };

  const sendWhatsappToStore = order => {
    const itemsList = order.items.map(i => `- ${i.qty}x ${i.name}`).join('%0A');
    const msg = `*${storeConfig.name.toUpperCase()}*%0A%0A*NOVO PEDIDO:* ${order.id}%0A*Cliente:* ${order.customer.name}%0A%0A*Itens:*%0A${itemsList}%0A%0A*Total:* ${formatCurrency(order.total)}`;
    window.open(`https://wa.me/${storeConfig.whatsapp}?text=${msg}`, '_blank');
  };

  const sendWhatsappToCustomer = order => {
    const cleanPhone = order.customer.phone.replace(/\D/g, ''); 
    const msg = `Olá, *${order.customer.name}*!%0A%0ASeu pedido na *${storeConfig.name}* foi confirmado.%0A*Total:* ${formatCurrency(order.total)}`;
    window.open(`https://wa.me/${cleanPhone}?text=${msg}`, '_blank');
  };

  /* ===================== COMPONENTES VISUAIS ===================== */
  const PriceDisplay = ({ price }) => {
    const pixPrice = price * (1 - storeConfig.pixDiscount);
    return (
      <div className="flex flex-col gap-1.5 text-right">
        <span className="text-xl font-light text-gray-900">{formatCurrency(price)}</span>
        <div className="space-y-0.5 border-r-2 border-[#A68966] pr-3">
          <div className="flex items-center justify-end gap-1.5">
            <span className="text-sm font-semibold text-[#A68966]">{formatCurrency(pixPrice)}</span>
            <span className="text-[9px] uppercase text-gray-400 font-sans">no pix</span>
          </div>
          <p className="text-[9px] text-gray-500 uppercase tracking-widest font-sans">
            ou {storeConfig.maxInstallments}x de {formatCurrency(price/storeConfig.maxInstallments)}
          </p>
        </div>
      </div>
    );
  };

  const PrintLayout = ({ order }) => (
    <div id={`print-receipt-${order.id}`} style={{ width: '210mm', minHeight: '296mm', padding: '20mm', backgroundColor: 'white', color: '#000' }}>
        <h1 style={{ textAlign: 'center', letterSpacing: '8px', textTransform: 'uppercase' }}>{storeConfig.name}</h1>
        <hr style={{ margin: '20px 0' }} />
        <p><strong>Cliente:</strong> {order.customer.name}</p>
        <p><strong>Data:</strong> {order.date}</p>
        <table style={{ width: '100%', marginTop: '20px', borderCollapse: 'collapse' }}>
            <thead><tr style={{ textAlign: 'left', borderBottom: '1px solid #000' }}><th>Item</th><th>Qtd</th><th>Total</th></tr></thead>
            <tbody>
                {order.items.map((i, idx) => (
                    <tr key={idx}><td>{i.name}</td><td>{i.qty}</td><td>{formatCurrency(i.price * i.qty)}</td></tr>
                ))}
            </tbody>
        </table>
        <div style={{ textAlign: 'right', marginTop: '30px', fontSize: '20px' }}><strong>TOTAL: {formatCurrency(order.total)}</strong></div>
    </div>
  );

  return (
    <div className="min-h-screen bg-[#FDFBF7] text-[#2D2926] font-serif pb-24">
      {/* HEADER */}
      <header className="sticky top-0 z-40 bg-white/90 backdrop-blur-md border-b border-[#E5DACE]/50 px-6 py-5 flex justify-between items-center">
        <button 
          onClick={goToAdmin} 
          className="p-3 -m-3 text-[#A68966] hover:scale-110 active:scale-95 transition-all"
        >
          <Unlock size={22} strokeWidth={1.5} />
        </button>
        
        <div className="flex flex-col items-center cursor-pointer" onClick={() => setView('catalog')}>
          <h1 className="text-lg tracking-[0.5em] uppercase font-light">{storeConfig.name}</h1>
          <div className="h-[1px] w-8 bg-[#A68966] mt-1"></div>
        </div>
        
        <button onClick={() => setView('cart')} className="relative text-[#A68966] p-3 -m-3 hover:scale-110 active:scale-95 transition-all">
          <ShoppingCart size={22} strokeWidth={1.5} />
          {cart.length > 0 && <span className="absolute top-1 right-1 bg-[#A68966] text-white text-[8px] rounded-full w-4 h-4 flex items-center justify-center font-sans font-bold border border-white">{cart.length}</span>}
        </button>
      </header>

      <main className="max-w-xl mx-auto p-4 md:p-8 font-sans">
        {view === 'catalog' && (
          <div className="grid gap-14 font-serif">
            {products.map(p => (
              <div key={p.id} className="group">
                <div className="aspect-[4/5] bg-[#F5F2EE] relative flex items-center justify-center overflow-hidden mb-6 shadow-sm">
                  {p.stock <= 0 && <div className="absolute inset-0 bg-white/80 z-10 flex items-center justify-center"><span className="border border-red-200 text-red-400 py-2 px-6 text-[10px] uppercase tracking-widest">Esgotado</span></div>}
                  {p.image ? <img src={p.image} className="w-full h-full object-cover" alt={p.name} /> : <ImageIcon size={64} className="opacity-10 text-[#A68966]" />}
                </div>
                <div className="space-y-6">
                  <div className="flex justify-between items-start border-b border-[#F5F2EE] pb-4">
                    <div className="space-y-1">
                      <p className="text-[9px] text-[#A68966] uppercase tracking-widest font-bold font-sans">{p.sku || 'REF-UNIQ'}</p>
                      <h3 className="font-light text-2xl text-gray-900 leading-tight">{p.name}</h3>
                    </div>
                    <PriceDisplay price={p.price} />
                  </div>
                  <button disabled={p.stock <= 0} onClick={() => addToCart(p)} className="w-full py-5 bg-[#2D2926] text-white text-[11px] uppercase font-bold tracking-[0.3em] font-sans hover:bg-black transition-colors disabled:opacity-50">Adicionar à sacola</button>
                </div>
              </div>
            ))}
          </div>
        )}

        {view === 'cart' && (
          <div className="space-y-8 animate-in fade-in duration-500">
             <div className="flex items-center gap-4 border-b border-[#F5F2EE] pb-6 font-serif">
              <button onClick={() => setView('catalog')} className="text-[#A68966] p-2 -ml-2"><ChevronLeft size={24}/></button>
              <h2 className="text-2xl italic font-light">Sua Sacola</h2>
            </div>
            {cart.length === 0 ? <p className="text-center py-20 text-gray-400 italic">Sacola vazia</p> : (
              <>
                <div className="space-y-4">
                  {cart.map(i => (
                    <div key={i.id} className="bg-white p-4 border border-[#F5F2EE] flex items-center gap-5 shadow-sm">
                      <div className="w-16 h-20 bg-[#F5F2EE] shrink-0">{i.image && <img src={i.image} className="w-full h-full object-cover" alt={i.name} />}</div>
                      <div className="flex-1">
                        <p className="text-[11px] font-bold uppercase">{i.name}</p>
                        <p className="text-[12px] text-gray-500">{i.qty}x {formatCurrency(i.price)}</p>
                      </div>
                      <button onClick={() => removeItem(i.id)} className="text-red-300 p-2"><Trash2 size={16}/></button>
                    </div>
                  ))}
                </div>
                <div className="bg-white p-6 border border-[#F5F2EE] space-y-4 shadow-sm">
                  <h4 className="text-[10px] uppercase tracking-widest text-[#A68966] font-bold font-sans">Dados do Cliente</h4>
                  <input className="w-full border-b py-3 text-sm outline-none focus:border-[#A68966] transition-colors" placeholder="Nome do Cliente" value={customer.name} onChange={e => setCustomer({...customer, name: e.target.value})} />
                  <input className="w-full border-b py-3 text-sm outline-none focus:border-[#A68966] transition-colors" placeholder="WhatsApp (ex: 11999999999)" value={customer.phone} onChange={e => setCustomer({...customer, phone: e.target.value})} />
                </div>
                <div className="bg-[#2D2926] text-white p-8 space-y-4 font-serif rounded-sm">
                  <div className="flex justify-between text-2xl italic border-b border-white/10 pb-4"><span>Total</span><span>{formatCurrency(total)}</span></div>
                  <p className="text-[10px] text-gray-400 font-sans uppercase tracking-[0.2em] text-center pt-2">Pagamento no ato da entrega ou via Pix</p>
                </div>
                <button onClick={finalizeSale} className="w-full bg-[#A68966] text-white py-6 uppercase font-bold tracking-[0.4em] hover:bg-[#8e7557] transition-colors shadow-lg">Finalizar Pedido</button>
              </>
            )}
          </div>
        )}

        {view === 'confirmed' && lastOrder && (
          <div className="text-center py-20 space-y-10 font-serif animate-in zoom-in duration-500">
            <CheckCircle2 size={80} className="mx-auto text-green-500" strokeWidth={1} />
            <h2 className="text-3xl italic font-light">Pedido Confirmado!</h2>
            <div className="space-y-4">
                <button onClick={() => sendWhatsappToStore(lastOrder)} className="w-full bg-[#25D366] text-white py-5 flex items-center justify-center gap-3 text-[10px] uppercase font-bold tracking-widest shadow-md hover:bg-[#1ebd5e] transition-colors">
                  <MessageCircle size={18}/> Notificar Loja via WhatsApp
                </button>
            </div>
            <button onClick={() => setView('catalog')} className="text-[#A68966] uppercase text-[9px] font-bold tracking-widest mt-6 border-b border-[#A68966] pb-1">Voltar ao Catálogo</button>
          </div>
        )}

        {view === 'admin' && (
          <div className="space-y-12 pb-24 font-sans animate-in slide-in-from-bottom duration-500">
             <div className="flex items-center justify-between border-b pb-6 font-serif">
                <button onClick={() => setView('catalog')} className="text-[#A68966] p-2 -ml-2"><ChevronLeft size={24}/></button>
                <h2 className="text-2xl italic font-light">Painel Administrativo</h2>
                <div className="w-24"></div> 
             </div>
             
             {/* Configurações */}
             <section className="bg-white p-6 border space-y-4 shadow-sm">
                <h3 className="text-[10px] font-bold uppercase tracking-widest text-[#A68966]">Dados da Empresa</h3>
                <div className="grid gap-4">
                    <input className="w-full border-b py-2 text-sm outline-none" placeholder="Nome da Loja" value={storeConfig.name} onChange={e => setStoreConfig({...storeConfig, name: e.target.value})} />
                    <input className="w-full border-b py-2 text-sm outline-none" placeholder="Número WhatsApp (DDI + DDD)" value={storeConfig.whatsapp} onChange={e => setStoreConfig({...storeConfig, whatsapp: e.target.value})} />
                </div>
                <button onClick={saveConfig} className="w-full bg-[#A68966] text-white py-3 text-[10px] uppercase font-bold tracking-widest shadow-sm">Atualizar Loja</button>
             </section>

             {/* Gestão de Inventário */}
             <section className="bg-white p-6 border space-y-4 shadow-sm">
                <h3 className="text-[10px] font-bold uppercase tracking-widest text-[#A68966]">Novo Produto</h3>
                <div className="h-40 bg-gray-50 border-2 border-dashed border-gray-200 flex items-center justify-center relative rounded-sm overflow-hidden group">
                    {newProduct.image ? (
                        <img src={newProduct.image} className="h-full w-full object-contain" alt="Preview" />
                    ) : (
                        <div className="flex flex-col items-center text-gray-300">
                            <Upload size={32} />
                            <span className="text-[10px] uppercase mt-2">Carregar Foto</span>
                        </div>
                    )}
                    <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={handleImageUpload} />
                </div>
                <div className="grid gap-4">
                    <input className="w-full border-b py-2 text-sm outline-none" placeholder="Nome da Joia" value={newProduct.name} onChange={e => setNewProduct({...newProduct, name: e.target.value})} />
                    <div className="flex gap-4">
                        <input className="w-full border-b py-2 text-sm outline-none" placeholder="Preço" type="number" value={newProduct.price} onChange={e => setNewProduct({...newProduct, price: e.target.value})} />
                        <input className="w-full border-b py-2 text-sm outline-none" placeholder="Stock" type="number" value={newProduct.stock} onChange={e => setNewProduct({...newProduct, stock: e.target.value})} />
                    </div>
                </div>
                <button onClick={addProduct} className="w-full bg-black text-white py-3 text-[10px] font-bold uppercase tracking-widest shadow-md">Adicionar ao Catálogo</button>
             </section>

             {/* Inventário Atual */}
             <section className="space-y-4">
                <h3 className="text-[10px] font-bold uppercase text-gray-400 tracking-widest">Inventário Ativo</h3>
                <div className="grid gap-3">
                    {products.map(p => (
                        <div key={p.id} className="flex items-center gap-4 bg-white p-3 border shadow-sm rounded-sm">
                            <div className="w-12 h-14 bg-gray-100 rounded-sm overflow-hidden flex-shrink-0">
                                {p.image && <img src={p.image} className="w-full h-full object-cover" alt={p.name} />}
                            </div>
                            <div className="flex-1 overflow-hidden">
                                <p className="text-[11px] font-bold uppercase truncate">{p.name}</p>
                                <p className="text-[10px] text-gray-500">{formatCurrency(p.price)} • {p.stock} un.</p>
                            </div>
                            <button onClick={() => deleteProduct(p.id)} className="text-red-300 hover:text-red-500 p-2 transition-colors">
                                <Trash2 size={18}/>
                            </button>
                        </div>
                    ))}
                </div>
             </section>

             {/* Histórico de Pedidos */}
             <section className="space-y-4">
                <h3 className="text-[10px] font-bold uppercase text-[#A68966] tracking-widest italic text-lg">Pedidos e Vendas</h3>
                <div className="grid gap-4">
                    {orders.length === 0 ? <p className="text-xs text-gray-400 italic">Nenhum pedido recente.</p> : orders.map(o => (
                        <div key={o.id} className="bg-white p-5 border shadow-sm space-y-4 rounded-sm">
                            <div className="flex justify-between items-start border-b pb-3">
                                <div>
                                    <span className="text-xs font-bold uppercase block">{o.customer.name}</span>
                                    <span className="text-[10px] text-gray-400 font-sans">ID: #{o.id} • {o.date}</span>
                                </div>
                                <button onClick={() => deleteOrder(o.id)} className="text-red-100 hover:text-red-400 transition-colors">
                                    <Trash2 size={16}/>
                                </button>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => generatePdf(o)} className="flex-1 py-2 border border-[#A68966] text-[9px] font-bold uppercase text-[#A68966] rounded-sm hover:bg-[#A68966]/5 transition-colors">PDF Recibo</button>
                                <button onClick={() => sendWhatsappToCustomer(o)} className="flex-1 py-2 border border-green-500 text-[9px] font-bold uppercase text-green-500 rounded-sm hover:bg-green-50 transition-colors">Falar com Cliente</button>
                            </div>
                        </div>
                    ))}
                </div>
             </section>
          </div>
        )}
      </main>

      {/* FOOTER NAVEGAÇÃO */}
      <footer className="fixed bottom-0 left-0 right-0 bg-white border-t border-[#E5DACE]/50 py-4 flex justify-around items-center z-40 shadow-[0_-2px_10px_rgba(0,0,0,0.02)]">
        <button 
          onClick={() => setView('catalog')} 
          className={`flex flex-col items-center gap-1 transition-all ${view === 'catalog' ? 'text-[#A68966] scale-110' : 'text-gray-300 hover:text-[#A68966]'}`}
        >
          <Store size={22} /><span className="text-[8px] uppercase font-bold tracking-widest font-sans">Vitrine</span>
        </button>
        
        <button 
          onClick={() => setView('cart')} 
          className={`flex flex-col items-center gap-1 transition-all ${view === 'cart' ? 'text-[#A68966] scale-110' : 'text-gray-300 hover:text-[#A68966]'}`}
        >
          <ShoppingCart size={22} /><span className="text-[8px] uppercase font-bold tracking-widest font-sans">Sacola</span>
        </button>
        
        <button 
          onClick={goToAdmin} 
          className={`flex flex-col items-center gap-1 transition-all ${view === 'admin' ? 'text-[#A68966] scale-110' : 'text-gray-300 hover:text-[#A68966]'}`}
        >
          <Package size={22} /><span className="text-[8px] uppercase font-bold tracking-widest font-sans">Gestão</span>
        </button>
      </footer>

      {/* Renderização PDF oculta */}
      <div style={{ position: 'absolute', left: '-10000px', top: 0, opacity: 0 }}>
        {orders.map(o => <PrintLayout key={o.id} order={o} />)}
      </div>
    </div>
  );
}
const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
    </script>
</body>
</html>
